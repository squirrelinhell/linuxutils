#!/bin/bash

INFO="
Rename images according to hashes generated by 'image-hash'.

Usage:
    image-rename <image1> [ <image2> ... ]
"

if [ "x$1" = x ]; then
    echo "$INFO" 1>&2
    exit 1
fi

for i in "$@"; do
    A=$(readlink -m "$i")
    if [ ! -f "$A" ]; then
        echo "Warning: skipping '$A' (not a file)" 2>&1
    else
        B="${A%/*}/"$(image-hash --ext "$i") || exit 1
        if [ "x$A" != "x$B" ]; then
            echo "Renaming '$A' -> '$B'..."
            mv -n "$A" "$B" || exit 1
        fi
    fi
done
